<!DOCTYPE html>
<html>
  <head>
    <title>Test Pi SDK - Tranmusickingdom</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  </head>
  <body>
    <h2>🧪 Test SDK Pi App – Tranmusickingdom</h2>
    <button onclick="login()">🔐 Đăng nhập Pi</button>
    <button onclick="pay()">💸 Thanh toán 0.01 Pi</button>

    <script>
      // Khởi tạo SDK (không dùng sandbox, để test thanh toán thật)
      Pi.init({ version: "2.0" });

      // Đăng nhập
      function login() {
        Pi.authenticate(['username'], function(auth) {
          console.log('Đăng nhập thành công:', auth);
          alert("✅ Đăng nhập thành công: " + auth.user.username);
        }, function(error) {
          console.error('Lỗi đăng nhập:', error);
          alert("❌ Lỗi đăng nhập: " + error);
        });
      }

      // Thanh toán 0.01 Pi
      function pay() {
        const paymentData = {
          amount: 0.01,
          memo: "Test for Tranmusickingdom",
          metadata: { purpose: "test", app: "Tranmusickingdom" }
        };

        Pi.createPayment(paymentData, {
          onReadyForServerApproval: function(paymentId) {
            console.log("Ready for server approval", paymentId);
            // Không có backend → bỏ qua
          },
          onReadyForServerCompletion: function(paymentId, txid) {
            console.log("Ready for server completion", paymentId, txid);
            // Không có backend → bỏ qua
          },
          onCancel: function(paymentId) {
            console.log("Người dùng hủy", paymentId);
            alert("❌ Người dùng đã huỷ giao dịch.");
          },
          onError: function(error, payment) {
            console.error("Lỗi:", error);
            alert("⚠️ Lỗi giao dịch: " + error);
          }
        });
      }
    </script>
  </body>
</html>
