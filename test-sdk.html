<!DOCTYPE html>
<html>
<head>
  <title>BuonBanVat SDK Test</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>ğŸ›’ BuonBanVat SDK Test</h1>
  <p>ChÃ o má»«ng Ä‘áº¿n vá»›i báº£n thá»­ nghiá»‡m chá»©c nÄƒng thanh toÃ¡n Pi.</p>
  <button id="login-button">Login with Pi</button>
  <button id="pay-button">ğŸ’³ Thanh toÃ¡n thá»­ 0.01 Pi</button>
  <p>ğŸ§ª ÄÃ¢y chá»‰ lÃ  phiÃªn báº£n test sandbox. KhÃ´ng cÃ³ Pi thá»±c sá»± Ä‘Æ°á»£c chuyá»ƒn.</p>

  <script>
    const Pi = window.Pi;

    // 1. Login
    document.getElementById("login-button").addEventListener("click", async () => {
      try {
        const scopes = ["username", "payments"];
        const authResult = await Pi.authenticate(scopes, onIncompletePaymentFound);
        alert(`Logged in as: ${authResult.user?.username || "undefined"}`);
      } catch (error) {
        alert(`Login failed: ${error}`);
      }
    });

    // 2. Test Pi Payment
    document.getElementById("pay-button").addEventListener("click", async () => {
      const paymentData = {
        amount: 0.01,
        memo: "Test payment for BuonBanVat",
        metadata: { purpose: "sandbox-test", app: "BuonBanVat" },
        sandbox: true // ğŸ‘ˆ Ä‘á»ƒ test offline khÃ´ng cáº§n backend
      };

      try {
        const payment = await Pi.createPayment(paymentData, {
          onReadyForServerApproval: (paymentId) => {
            console.log("Payment ready for server approval", paymentId);
            // Tá»± Ä‘á»™ng approve trong sandbox
            Pi.approvePayment(paymentId);
          },
          onReadyForServerCompletion: (paymentId, txid) => {
            console.log("Payment ready for server completion", paymentId, txid);
            Pi.completePayment(paymentId);
          },
          onCancel: (paymentId) => {
            console.log("Payment cancelled", paymentId);
          },
          onError: (error, payment) => {
            console.error("Payment error", error);
          }
        });
      } catch (error) {
        alert(`Thanh toÃ¡n lá»—i: ${error}`);
      }
    });

    // 3. Xá»­ lÃ½ cÃ¡c thanh toÃ¡n chÆ°a hoÃ n táº¥t
    async function onIncompletePaymentFound(payment) {
      console.log("Found incomplete payment", payment);
    }
  </script>
</body>
</html>
