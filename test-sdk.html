<!DOCTYPE html>
<html>
  <head>
    <title>TranMarket Pi SDK Test</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
      Pi.init({ version: "2.0" });
    </script>
  </head>
  <body>
    <h1>TranMarket Pi SDK Test</h1>
    <button onclick="loginWithPi()">Login with Pi</button>
    <button onclick="testPayment()">Test Pi Payment</button>

    <script>
      async function loginWithPi() {
        try {
          const scopes = ['username', 'payments'];
          const user = await Pi.authenticate(scopes);
          alert(`Logged in as: ${user.username}`);
        } catch (err) {
          alert(`Login failed: ${err}`);
        }
      }

      async function testPayment() {
        try {
          const paymentData = {
            amount: 0.001,
            memo: "Test payment",
            metadata: { type: "test" }
          };
          const payment = await Pi.createPayment(paymentData, {
            onReadyForServerApproval: function(paymentId) {
              console.log("Ready for server approval:", paymentId);
            },
            onCancel: function(paymentId) {
              console.log("Cancelled:", paymentId);
            },
            onError: function(error, paymentId) {
              console.log("Error:", error, paymentId);
            },
            onReadyForServerCompletion: function(paymentId, txid) {
              console.log("Ready for server completion:", paymentId, txid);
            },
          });
        } catch (err) {
          alert("Payment failed: " + err);
        }
      }
    </script>
  </body>
</html>
